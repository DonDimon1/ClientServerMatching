Решение тестового задания
Задание выполнил: Павлов Д.А. тел.:89198350407
https://github.com/DonDimon1/ClientServerMatching

# **Описание**
---------------------------------------------------------------------------------------------------------------------
Проект основан на шаблоне взаимодействия с сервером, представленном в тестовом задании. Основной функционал разработан согласно функциональным требованиям. Все основные торговые сценарии на сервере покрыты тестами, с использованием `boost test framework`. 

Программа клиентской части реализует функционал взаимодействия с сервером для управления финансовыми операциями пользователей. В начале сеанса клиент устанавливает соединение с сервером, после чего создаёт нового пользователя и получает уникальный идентификатор (ID) от сервера. Далее пользователю становится доступно основное меню, предоставляющее выбор различных операций.

Основное меню было расширено новым функционалом, позволяющим добавлять новые финансовые заявки и просматривать текущий баланс. Функция `AddOrder` отвечает за формирование и отправку новых заявок на сервер. Запросив необходимые данные у пользователя и обработав их, данная функция отправляет пакет на сервер, с помощью функции `SendMessage`.

Серверная часть программы была значительно переписана для улучшения функциональности и производительности. В основе новой реализации лежит метод `handle_read` класса session, который отвечает за обработку входящих пакетов данных. Исполнение команд и формирование ответов клиентам осуществляет класс `Core`. Для повышения читаемости и удобства сопровождения, класс `Core` был разделён на два отдельных файла — для определения полей методов, и их реализации.

Основные поля класса `Core` хранят информацию о пользователях и их данных. Имена и балансы всех пользователей сохраняются в структурах `map`, где ключом является идентификатор пользователя. Помимо этого, в класс добавлены два адаптера `std::priority_queue` на основе `std::vector` для хранения заявок на покупку и продажу. Обработка этих заявок осуществляется в три этапа.

1. Создание заявки: Метод `AddOrder` создаёт новую заявку пользователя и вызывает функцию `MatchOrder` для дальнейшей обработки.
2. Сопоставление заявок: В функции `MatchOrder` происходит определение объема заявки и поиск заявок противоположного типа. Например, для осуществления транзакции, заявке на покупку требуются заявки на продажу. Текущая заявка сравнивается с заявками противоположного типа, и при совпадении условий (например, подходящая цена) осуществляется транзакция с использованием метода `UpdateBalance`.
3. Обновление и сохранение заявок: После транзакции обновляются объёмы текущих заявок. Если объем заявки противоположного типа исчерпан, обрабатывается следующая заявка. Если объём текущей заявки исчерпан, цикл обработки прерывается. Если все противоположные заявки обработаны, а текущая заявка ещё актуальна, она сохраняется в структуру очереди с приоритетом заявок текущего типа. Данная очередь необходима для обеспечения приоритета исполнения заявок с максимальной ценой над заявками с минимальной ценой.

На завершающем этапе пользователю отправляется уведомление о выполненной операции. Если заявки противоположного типа отсутствуют или их цены не соответствуют требованиям, текущая заявка становится активной, сохраняется и ожидает дальнейшей обработки.

Файл `Tests.cpp` содержит автоматические тесты, файл `Common.hpp` обозначения основных операций и типов заявок, файл `json.hpp` не изменялся.

# **Инструкция по сборке проекта**
-----
#### **Шаг 1: Установите зависимости**
Убедитесь, что у вас установлены следующие зависимости:**

- CMake (версии 3.21 и выше)
- Компилятор, поддерживающий C++17
- Библиотека Boost (включая компоненты system, filesystem, и unit\_test\_framework)
#### **Шаг 2: Установите Boost**
Для установки зависимостей на Linux вы можете использовать пакетный менеджер вашей системы, например, для Debian-based дистрибутивов (например, Ubuntu), вы можете использовать следующие команды:
```
sudo apt update
sudo apt install cmake g++ libboost-all-dev
```
Если Boost не установлен через пакетный менеджер, cкачайте и установите его вручную. Для этого перейдите на официальный сайт Boost и следуйте инструкциям по установке. Если CMake не сможет обнаружить Boost автоматически, введите путь к библиотекам и заголовочным файлам в CMake-файле:
``` 
set(BOOST_ROOT "/path/to/your/boost")
set(BOOST_INCLUDEDIR "${BOOST_ROOT}/include")
set(BOOST_LIBRARYDIR "${BOOST_ROOT}/lib")
```
#### **Шаг 3: Соберите проект**
Запустите сборку проекта с помощью Вашей IDE или в консоли вашей ОС: 
``` 
# Перейти в корневой каталог проекта
cd /path/to/your/project
# Создать каталог для сборки и перейти в него
mkdir build
cd build
# Сгенерировать файлы сборки, укажите путь до Boost
cmake -DBOOST_ROOT="/path/to/boost" ..
# Собрать проект
cmake --build .
``` 
Если все зависимости найдены правильно, вы должны увидеть сообщение о том, что Boost был найден, например:
``` 
-- Found BOOST 1.85.0
``` 
# **Инструкция по использованию проекта**
-----
**Запуск сервера**
Запустите сервер с помощью Вашей IDE, либо в консоли ОС:
1. Перейдите в директорию build.
2. Выполните команду для запуска сервера:
``` 
./Server   # для Linux
Server.exe # для Windows
``` 
**Запуск клиента**
Запустите клиент с помощью Вашей IDE, либо в консоли ОС:
1. Перейдите в директорию build.
2. Выполните команду для запуска клиента:
``` 
./Client   # для Linux
Client.exe # для Windows
``` 
**Тестирование**
1. Перейдите в директорию build.
2. Выполните команду для запуска тестов:
``` 
ctest
``` 
# **Руководство по использованию меню проекта**
-----
Взаимодействие с пользователем на клиенте начинается с регистрации нового пользователя на сервере.
После запуска клиента мы видем в консоли просьбу ввести наше имя:
``` 
Hello! Enter your name:
``` 
После того как пользователь ввёл своё имя, в консоли появляется основное меню для взаимодействия с программой.
``` 
Menu:
1) Hello Request
2) Balance      
3) Add order    
4) Exit
```
Далее программа ожидает ввода команды от пользователя.
Пункт 1): Существует для примера, если пользователь его выбирет, то сервер выведет в консоль приветсвтие с именем пользователя.
Пункт 2): Просмотр баланса пользователя. Когда пользователь выберет этот пункт, сервер в ответ выведет количество USD и RUB на балансе данного пользователя.
Пункт 3): Регистрация новой заявки для биржи. Если пользователь выбирает данный пункт, то он попадает в подменю регистрации заявки. Первым делом нужно выбрать тип заявки - покупка или продажа:
```
Enter order type (1 = buy/ 2 = sell): 
```
1 означает покупка, 2 - продажа.
Далее нужно указать объём заявки:
```
Enter volume:
```
И последним пунктом нужно указать цену: 
```
Enter price:
```
После этого сервер обработает заявку, и выведет в консоль результат её обработки. Например, если транзакция ещё не совершилась, в консоль будет выведено сообщение:
```
No matching orders found
```
Если транзакция была совершена то информация об этом также будет выведена в консоль:
```
Matched 10.000000 USD at 62.000000 RUB with User 5
```
Если на этапе ввода данных пользователь введёт данные некорректно, то программа вернётся в основное меню.
Пункт 4): Выход из программы клиента.

Спасибо за внимание!